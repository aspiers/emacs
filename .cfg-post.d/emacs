#!/bin/sh

version=$( emacs --version | \
             perl -ne '/^\s*(GNU |X)Emacs (\d+\.\d+)/ && print "$2"' )

cd
[ -e .as-init.el ] || \
  ln -sf lib/emacs/init/common/as-init.el .as-init.el
[ -e .as-bindings.el ] || \
  ln -sf lib/emacs/init/common/as-bindings.el .as-bindings.el
[ -e .as-gtd.el ] || \
  ln -sf lib/emacs/utils/as-gtd.el .as-gtd.el

ln -sf lib/emacs/init/GNU_Emacs/as-custom-$version.el .as-custom.el
for c in lib/emacs/init/GNU_Emacs/as-custom-*.el; do
  ln -sf $c .${c##*/}
done

[ -e .msf-abbrevs ] || \
  ln -sf lib/emacs/minor-modes/msf-abbrev/mode-abbrevs .msf-abbrevs
[ -e lib/emacs/major-modes/muse ] || \
  ln -sf muse--main--1.0 lib/emacs/major-modes/muse

if which gconftool-2 >/dev/null 2>&1; then
  gconftool-2 -s /desktop/gnome/url-handlers/annotation/command \
    -t string 'org-annotation-helper %s'
  gconftool-2 -s /desktop/gnome/url-handlers/annotation/enabled -t bool yes

  gconftool-2 -s /desktop/gnome/url-handlers/remember/command \
    -t string 'org-annotation-helper %s'
  gconftool-2 -s /desktop/gnome/url-handlers/remember/enabled -t bool yes
fi

# Put this last as it's most likely to fail.

emk